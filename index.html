<html>
	<head>
		<meta charset="utf-8">
		<title>
			Usablog
		</title>
		<link rel="stylesheet" href="css/boilerplate.css" type="text/css">
		<link rel="stylesheet" href="css/style.css" type="text/css">
		<script src="js/libs/modernizr-2.0.6.min.js" type="text/javascript"></script>
		<script src="http://code.jquery.com/jquery-1.6.min.js" type="text/javascript"></script>
		<script type="text/javascript">
		var start, elapsed;

		function milliseconds_to_minutes_and_seconds(ms) {
		s = Math.floor((ms/1000)%60) - 3; //offset 3 seconds for the lag of recording the observation; this will make timestamps closer
		m = Math.floor((ms/(1000*60))%60);
		if(s<0) s="0";
		if(s<10) s = "0" + s;
		if(m<10) m = "0" + m;
		return ( m + ":" + s);
		}
		function init() {
				session = localStorage.getItem("usablog.currentSession");
				if (session == null) {
					session = "Default Session"
				} 

		$("#session").html(session);

		$("#log").html(localStorage.getItem("usablog." + session + ".localStore"));
		$('html, body').animate({scrollTop: $(document).height()}, 'slow');
		$("#note").val("").focus();
		}

		$(function() {
		init();


		$("#logNote").click(function() {
		if( $("#note").val() != "") {
		start = localStorage.getItem("usablog." + session + ".startTime");
			if (start == null){
				 start = new Date().getTime();
				 localStorage.setItem("usablog." + session + ".startTime", start);
				}
			elapsed = (new Date().getTime()) - start;
			$("#log").append("<tr><td>" + milliseconds_to_minutes_and_seconds(elapsed) + "</td><td>" + $("#note").val() + "</td></tr>");
			localStorage.setItem("usablog." + session + ".localStore", $("#log").html());
			init();
		}
		});

		$("#changeSession").click(function(){
			var newSession = prompt("What do you want to call this session?", session);
			session = newSession;
			localStorage.setItem("usablog.currentSession", session);
		init();
		});

$("#wtf").click(function(){
alert("Usablog is an experimental HTML5 usability test observation logging tool built by Will Sansbury. Use at your own risk. View source only if you're not afraid of nasty code.");
});
		//Clear localStorage    
		$("#nuke").click(function(){
			var nukeConfirm = confirm("The nuclear option clears all of your notes. If you click OK, your data will be lost and cannot be recovered. Are you sure you want to go through with this?");
			if (nukeConfirm == true)
			  {
				localStorage.clear();
			  }
			else
			  {
				return false;
			  }
			init();
		})
		});
		</script>
	</head>
	<body>
<header>
	<h1>Usablog</h1>
	<h2 id="session"></h2>
	<a href="#" id="changeSession">Change Session</a> 
	<a href="#" id="wtf">What is Usablog?</a>
	<a href="http://twitter.com/intent/tweet?text=Hey+%40willsansbury%2C+it%27d+be+cool+if+Usablog+could...+http%3A%2F%2Fusablog.willsansbury.com&source=clicktotweet" id="suggestions" target="_blank">Comments or Suggestions?</a>
	<a href="#" id="nuke">Nuclear Option</a>
</header>

		<table id="log">
		</table>
		<footer>
			<form>
			<label for="note">Log entry</label> <input type="text" id="note"> <input type="submit" id="logNote" value="Log">
			</form>
			
		</footer>
	</body>
</html>
